# AnomalyDetection

画像認識AIを活用した異常検知システム。リアルタイムカメラストリーミングとAI分析を組み合わせた監視システムです。

## 機能

- リアルタイムカメラストリーミング
- Webブラウザでの映像確認
- 低レイテンシーなMJPEGストリーミング
- マルチスレッドによる効率的な処理
- スペースキーによる画像キャプチャ機能
  - タイムスタンプ付きで自動保存
  - キャプチャ時のフラッシュ効果
- 複数カメラの切り替え機能
- カメラ解像度の設定機能

## セットアップ

### 必要条件

- Python 3.8以上
- OpenCV
- FastAPI
- uvicorn
- Node.js (フロントエンド開発用)

### インストール手順

1. リポジトリのクローン
```bash
git clone https://github.com/yourusername/AnomalyDetection.git
cd AnomalyDetection
```

2. バックエンド依存パッケージのインストール (Dockerを使用しない場合)
```bash
pip install -r docker/requirements.txt
```

3. フロントエンド依存パッケージのインストール (Dockerを使用しない場合)
```bash
npm install
```

### Docker環境での実行

```bash
docker compose up --build
```

## 使用方法

1. Docker Composeでアプリケーションを起動
   ```bash
   docker compose up
   ```
   (バックグラウンドで起動する場合は `docker compose up -d`)

2. ブラウザでアクセス
   ```
   http://localhost:8000
   ```

3. 画像キャプチャ
   - ブラウザ上でストリーミング映像を表示中に、スペースキーを押すか、「キャプチャ」ボタンをクリックすると現在のフレームをキャプチャできます。
   - キャプチャした画像は `captures/` ディレクトリに自動保存されます。
   - ファイル名は `capture_YYYYMMDD_HHMMSS.jpg` の形式で保存されます。

## カメラ制御機能

### 利用可能なカメラ
- PCに接続された複数のカメラをサポートします。
- 内蔵Webカメラ、USBカメラなどを自動検出し、利用可能なデバイスをプルダウンに表示します。

### カメラの切り替え
- 画面上部の「カメラを選択してください」というプルダウンメニューから使用したいカメラを選択します。
- 選択後、映像がリアルタイムで切り替わります。
- カメラ切り替え時に、対応する解像度リストも自動的に更新されます。

### 解像度の設定
- カメラ選択プルダウンの下にある「解像度を選択してください」というプルダウンメニューから、希望の解像度を選択します。
- 選択後、カメラ映像の解像度が変更されます。
- カメラやドライバの互換性により、要求した解像度が適用されない場合や、エラーが発生する可能性があります。

### 注意事項
- カメラデバイスへのアクセス権限が必要です。
- Docker環境で実行する場合、コンテナにカメラデバイスが正しくマウントされている必要があります。
- デバイスの抜き差しを行った場合は、ブラウザのページをリロードするか、アプリケーションの再起動が必要な場合があります。

## 技術詳細

システムの技術的な詳細については、[技術解説書](docs/technical-notes.md)をご参照ください。

## ライセンス

MIT License